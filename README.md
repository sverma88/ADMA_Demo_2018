# ADMA Demo 2018
The repository contains software library for __Data Augmentation Services__

# Requirements
python 3.x  
numpy > 1.13  
scipy > 0.19  
pillow > 5.2  
tensorflow (gpu) > 1.3  
MATLAB  

# Stage 1
Contains two parts (i) Training GAN and (ii) Training Ensemble Classifier

## Train GAN
We provide modified version of DCGAN taken from https://github.com/carpedm20/DCGAN-tensorflow
The discriminator and the generator are conditioned on the labels of the images and have less layers than the DCGAN model available at the link above.

To execute the GAN and generate images go to DAS/Stage-1/Train_GAN/ and execute the main file by typing the command on the terminal python main.py 

This will download CIFAR-10 dataset automatically to the path specified.
The GAN will be trained for category 0 against all with the default parameters specified in the file main.py.
Synthetically Generated Images and associated Labels will be saved in __DAS/Stage-1/Train_GAN/Geneated_Data__ folder.  
Example files already exists in this path, __Images_10_1_2.mat__ and __Labels_10_0_1.mat__

Naming Convention Images_alpha_CategoryA_CategoryB and similarly Labels_alpha_CategoryA_CategoryB

If you wish to change the categories on which GAN is trained then please edit file __DAS/Stage-1/Train_GAN/DCGAN_Modified.py__  
**Line 162, fixed_label = 0** and
**Line 163, iter_labels = np.arange((fixed_label + 1), 10)**  

If you want to specify the split ratio of training dataset while training GAN then edit  
**Line 159, alpha = 0.1**  

## Train Ensemble Classifieris
To train Ensemble classifier execute the main MATLAB file __TrainEnsemble.m__ found at __DAS/Stage-1/TrainEnsemClass/__  

We train SVM, k-NN and naive Bayes available at MATLAB-R2018a
The codes and necessary functions are in the folder __DAS/Stage-1/Train_EnsemClass/__  

Trained parameters of the classifier's will get save in a mat file __DAS/Stage-1/TrainEnsemClass__, example file exists in the folder name __MODEL_X_Y.mat__   
X : Category 1
Y : Category 2  

You can specify on which labels you want to train your ensemble classifier then edit file __TrainEnsemble.m__  
**Line 14, fixed_label = 1**  
**Line 15, selected_labels = [(fixed_label+1):10]**  


# Stage 2
Once training of then GAN and ensemble classifier is finished and outputs are saved in their corresponding locations. Move to __DAS/Stage-2/__ for filtering synthetic Images and obtaining performance measuer of CNN trained on augmented datasets.  

## Filter Unbiased Images
Execute the main MATLAB file __Filter_Images.m__ found at __DAS/Stage-2/Filter_Unbiased_Images/__ to filter the synthetic images generated by the GAN.  

Path of the training data, the saved model, and the generated data is required. They are already set in the __Filter_Images.m__ file. However you can modify them to any locations, the details are as below:  
__Line 16, path of the trained ensemble classifier's model__  
__Line 17, path of the training data__  
__Line 78, path of the generated data__  

Once the code terminates output file named __Batches_alpha_CategoryA_CategoryB__ will be saved in  
__DAS/Stage-2/Filter_Unbiased_Images/Filtered_Images/__  
This file contains the test data and its labels, batches of training and filter images for 3-fold cross-validation.   

## Train CNN on Augmented datasets 
Execute __python main.py__ on the terminal to train VGG-style CNN adopted from https://github.com/soumith/DeepLearningFrameworks/blob/master/Tensorflow_CIFAR.ipynb. The file is available at __DAS/Stage-2/Train_CNN/__  

This will train the CNN on Augmenetd dataset obtained from the filtering stage i.e. __Stage - 2__ of __Data Augmentation Services__  
The outputs will get saved in __DAS/Stage-2/Train_CNN/results__ folder with name __Accuracy_alpha_CategoryA_CategoryB__ and __Pred_Labels_alpha_CategoryA_CategoryB__.

If you wish to train the CNN on true training CIFAR dataset then please edit the main.py script  
__Line 5, change from VGG_CNN_CIFAR import VGG to from VGG_CNN_Baseline import VGG__  

## Calculate Performace Measures
The final step is to obtain the measures of the bias, the variance and, the accuracy of our model after training on the augmenetd dataset.  
Please execute Calculate_Performace.m. It requires path to the directory where results after saved by the CNN model and the path to the directory where the augmeneted data is stored.  

**Line 5, path to the CNN results directory**  
**Line 6, path to the augmented dataset**


